"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7983],{14585:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>m,frontMatter:()=>r,metadata:()=>n,toc:()=>l});var n=o(81277),s=o(74848),i=o(28453);const r={title:"Reset Forgotten Domain Admin Password",authors:["mark-burton"],tags:["Active Directory","Windows Server 2019"],description:"Having failed to press save in my password manager I soon found out I didn't know my only domain admin password",date:"2021-02-28"},a=void 0,d={authorsImageUrls:[void 0]},l=[];function c(e){const t={a:"a",code:"code",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["Following a series of errors I found myself in a very similar situation to that described by ",(0,s.jsx)(t.a,{href:"https:/robbeekmans.neteucreset-your-domain-admin-password",children:"Rob Beekmans"}),", just without the excuse of a bout of flu. But it was just a lab environment so  The basic mistakes I made were:  * Only having a single domain admin in the domain."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Setting up a DSRM password but not testing it"}),"\n",(0,s.jsx)(t.li,{children:"Creating a single snapshot of the VM over 2 years ago"}),"\n",(0,s.jsx)(t.li,{children:"Allowing Windows update to reboot the machine with the new password unsaved in the vault."}),"\n",(0,s.jsx)(t.li,{children:"Using Hyper-V with an external Virtual Switch, but that is a that is for a different post"}),"\n",(0,s.jsxs)(t.li,{children:["Using a keyboards with different layouts to type passwords  So there was no reason to find myself in this position really, but having ended up there and having found ",(0,s.jsx)(t.a,{href:"https:/robbeekmans.neteucreset-your-domain-admin-password",children:"Robs post"})," it looked like the solution was still quite easy, however I am running Windows Server 2019 Core, so there is not GUI and therefore no UTILMAN.exe.  ## The Recovery\nBoot using the installation media, choose ",(0,s.jsx)(t.code,{children:"Repair your computer"}),", ",(0,s.jsx)(t.code,{children:"Troubleshoot"})," and ",(0,s.jsx)(t.code,{children:"Command Prompt"}),".  You will now be in the command prompt at ",(0,s.jsx)(t.code,{children:"X:\\Sources"}),".  To find your Windows install change directory ",(0,s.jsx)(t.code,{children:"cd /d c:\\Windows\\System32"}),"  Where Rob suggests to overwrite UTILMAN.exe with cmd.exe that is not possible in Windows Server Core, instead we can replace ",(0,s.jsx)(t.code,{children:"LogonUI.exe"}),"  ```\ncopy LogonUI.exe LogonUI.exe.BAK\ncopy CMD.EXE LogonUI.exe"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:'Answer yes when asked if you want to overwrite LogonUI.exe and then reboot normally.  ```\nshutdown /r /t 1\n```  When it reboots you will be taken straight to `cmd.exe`, you can now set the Administrator password with the command  ```\nnet user Administrator "new password"\n```  Boot again using the installation media to change the file names back  ```\ncopy LogonUI.exe.BAK LogonUI.exe\ndel LogonUI.exe.BAK\n```  Reboot a final time and login with your new Administrator password  ## Other options\nVarious blogs suggest it is possible to get to safe mode using F8 or Ctrl+Shift+Alt+F8 from a cold boot.\nhttps:/www.surfacetablethelp.com201801how-to-use-f8-key-to-boot-hyper-v-vm-into-safe-mode-on-windows-10.html  I was not able to make that work reliably, in fact it worked once and caused much frustration trying to make it happen again.  I found 2 more reliable ways to get to the safe boot menu:\nboot from the installation media to access to troubleshoot menu and boot to a command prompt.  At the command prompt type the following command to enable to boot menu.  ```\nbcdedit /set displaybootmenu yes\n```  The next command sets the timeout after which the boot will continue to the OS, 5 second should be plenty to press F8 without adding excessive time to the boot.  ```\nbcdedit /set timeout 5\n```  It is then possible to login with the  Test it, shut it down, cold boot it, test it again\nhttps:/docs.microsoft.comen-ustroubleshootwindows-serveridentityreset-directory-services-restore-mode-admin-pwd  https:/docs.microsoft.comen-ustroubleshootazurevirtual-machinescannot-connect-rdp-azure-vm#:~:text=The%20remote%20computer%20that%20you,the%20System%20Properties%20dialog%20box.\n'})})]})}function m(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,t,o)=>{o.d(t,{R:()=>r,x:()=>a});var n=o(96540);const s={},i=n.createContext(s);function r(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(i.Provider,{value:t},e.children)}},81277:e=>{e.exports=JSON.parse('{"permalink":"/docs/blog/2021/02/28/reset-forgotten-domain-admin-password","editUrl":"https://github.com/MarkZither/mywyamblog/tree/main/docs/blog/2021-02-28-reset-forgotten-domain-admin-password.md","source":"@site/blog/2021-02-28-reset-forgotten-domain-admin-password.md","title":"Reset Forgotten Domain Admin Password","description":"Having failed to press save in my password manager I soon found out I didn\'t know my only domain admin password","date":"2021-02-28T00:00:00.000Z","tags":[{"inline":false,"label":"Active Directory","permalink":"/docs/blog/tags/active-directory","description":"Microsoft Active Directory"},{"inline":false,"label":"Windows Server 2019","permalink":"/docs/blog/tags/windows-server-2019","description":"Microsoft Windows Server 2019"}],"readingTime":2.52,"hasTruncateMarker":false,"authors":[{"name":"Mark Burton","title":"Software Engineer & Technical Writer","url":"https://github.com/MarkZither","imageURL":"https://github.com/MarkZither.png","key":"mark-burton","page":null}],"frontMatter":{"title":"Reset Forgotten Domain Admin Password","authors":["mark-burton"],"tags":["Active Directory","Windows Server 2019"],"description":"Having failed to press save in my password manager I soon found out I didn\'t know my only domain admin password","date":"2021-02-28"},"unlisted":false,"prevItem":{"title":"Adding Chaos and Resiliency to asp.net Service with Polly and Simmy","permalink":"/docs/blog/2021/04/03/adding-chaos-and-resiliency-to-aspnet-services"},"nextItem":{"title":"First Look at Project Tye","permalink":"/docs/blog/2021/02/07/first-look-at-project-tye"}}')}}]);